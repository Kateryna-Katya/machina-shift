{"version":3,"file":"index.js","sources":["../src/main.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', () => {\n  console.log('DOM Loaded. Initializing Machina Shift...');\n\n  // Запуск всех модулей\n  initIcons();\n  initSmoothScroll();\n  initMobileMenu();\n  initHeroAnimation();\n  initStats();\n  initAccordion();\n  initForm();\n  initCookies(); // Запуск логики куки\n});\n\n/* 1. ICONS */\nfunction initIcons() {\n  if (typeof lucide !== 'undefined') lucide.createIcons();\n}\n\n/* 2. SCROLL */\nfunction initSmoothScroll() {\n  if (typeof Lenis === 'undefined') return;\n  const lenis = new Lenis({\n      duration: 1.2,\n      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),\n      smooth: true,\n  });\n  function raf(time) {\n      lenis.raf(time);\n      requestAnimationFrame(raf);\n  }\n  requestAnimationFrame(raf);\n}\n\n/* 3. MENU */\nfunction initMobileMenu() {\n  const burger = document.querySelector('.header__burger');\n  const closeBtn = document.querySelector('.mobile-menu__close');\n  const mobileMenu = document.querySelector('.mobile-menu');\n  const links = document.querySelectorAll('.mobile-menu__link, .mobile-menu__btn');\n\n  if (!burger || !mobileMenu) return;\n\n  const toggle = () => {\n      mobileMenu.classList.toggle('is-open');\n      document.body.style.overflow = mobileMenu.classList.contains('is-open') ? 'hidden' : '';\n  };\n\n  burger.addEventListener('click', (e) => { e.stopPropagation(); toggle(); });\n  if (closeBtn) closeBtn.addEventListener('click', toggle);\n  links.forEach(l => l.addEventListener('click', toggle));\n}\n\n/* 4. HERO ANIMATION (With Error Handling) */\nfunction initHeroAnimation() {\n  const container = document.getElementById('canvas-container');\n  if (!container || typeof THREE === 'undefined') return;\n\n  try {\n      const scene = new THREE.Scene();\n      const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\n      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });\n      renderer.setSize(window.innerWidth, window.innerHeight);\n      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n      container.appendChild(renderer.domElement);\n\n      const loader = new THREE.TextureLoader();\n      loader.setCrossOrigin('anonymous');\n\n      // Используем надежный источник Unsplash\n      const imgUrl = 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop';\n\n      const texture = loader.load(imgUrl, () => {}, undefined, () => console.log('Texture err'));\n\n      const mouse = new THREE.Vector2(0, 0);\n      const targetMouse = new THREE.Vector2(0, 0);\n      const uniforms = {\n          uTime: { value: 0 },\n          uTexture: { value: texture },\n          uMouse: { value: mouse },\n          uResolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) }\n      };\n\n      const material = new THREE.ShaderMaterial({\n          uniforms: uniforms,\n          vertexShader: `varying vec2 vUv; void main() { vUv = uv; gl_Position = vec4(position, 1.0); }`,\n          fragmentShader: `\n              uniform float uTime;\n              uniform sampler2D uTexture;\n              uniform vec2 uMouse;\n              uniform vec2 uResolution;\n              varying vec2 vUv;\n              void main() {\n                  vec2 uv = vUv;\n                  float aspect = uResolution.x / uResolution.y;\n                  vec2 m = uMouse; m.x *= aspect;\n                  vec2 uva = uv; uva.x *= aspect;\n                  float dist = distance(uva, m);\n                  float influence = smoothstep(0.45, 0.0, dist);\n                  uv.x += influence * (uv.x - uMouse.x) * 0.2;\n                  uv.y += influence * (uv.y - uMouse.y) * 0.2;\n                  vec4 color = texture2D(uTexture, uv);\n                  color.rgb *= 0.35;\n                  color.rgb += vec3(influence * 0.2, influence * 0.4, 0.0);\n                  gl_FragColor = color;\n              }\n          `\n      });\n\n      scene.add(new THREE.Mesh(new THREE.PlaneGeometry(2, 2), material));\n\n      document.addEventListener('mousemove', (e) => {\n          targetMouse.x = e.clientX / window.innerWidth;\n          targetMouse.y = 1.0 - (e.clientY / window.innerHeight);\n      });\n\n      window.addEventListener('resize', () => {\n          renderer.setSize(window.innerWidth, window.innerHeight);\n          uniforms.uResolution.value.x = window.innerWidth;\n          uniforms.uResolution.value.y = window.innerHeight;\n      });\n\n      const clock = new THREE.Clock();\n      function animate() {\n          requestAnimationFrame(animate);\n          uniforms.uTime.value = clock.getElapsedTime();\n          mouse.x += (targetMouse.x - mouse.x) * 0.08;\n          mouse.y += (targetMouse.y - mouse.y) * 0.08;\n          renderer.render(scene, camera);\n      }\n      animate();\n  } catch (e) { console.error(e); }\n}\n\n/* 5. STATS */\nfunction initStats() {\n  const section = document.querySelector('.stats-grid');\n  const numbers = document.querySelectorAll('.stat-number');\n  let started = false;\n\n  if (!section || !numbers.length) return;\n\n  const obs = new IntersectionObserver((entries) => {\n      if (entries[0].isIntersecting && !started) {\n          started = true;\n          numbers.forEach(num => {\n              const target = parseFloat(num.getAttribute('data-target'));\n              const isFloat = target % 1 !== 0;\n              let current = 0;\n              const step = target / 50; // 50 frames\n              const timer = setInterval(() => {\n                  current += step;\n                  if (current >= target) { current = target; clearInterval(timer); }\n                  num.innerText = isFloat ? current.toFixed(1) : Math.round(current);\n              }, 30);\n          });\n      }\n  }, { threshold: 0.5 });\n  obs.observe(section);\n}\n\n/* 6. ACCORDION */\nfunction initAccordion() {\n  document.querySelectorAll('.accordion-header').forEach(h => {\n      h.addEventListener('click', () => {\n          const isOpen = h.classList.contains('active');\n          document.querySelectorAll('.accordion-header').forEach(el => {\n              el.classList.remove('active');\n              el.nextElementSibling.style.maxHeight = null;\n          });\n          if (!isOpen) {\n              h.classList.add('active');\n              h.nextElementSibling.style.maxHeight = h.nextElementSibling.scrollHeight + \"px\";\n          }\n      });\n  });\n}\n\n/* 7. FORM */\nfunction initForm() {\n  const form = document.getElementById('lead-form');\n  const msg = document.getElementById('form-message');\n  if (!form) return;\n\n  form.addEventListener('submit', (e) => {\n      e.preventDefault();\n      if (document.getElementById('captcha').value != '8') {\n          msg.textContent = 'Ошибка: 5 + 3 = 8'; msg.className = 'form-message error'; return;\n      }\n      const btn = form.querySelector('button');\n      const txt = btn.textContent;\n      btn.textContent = '...'; btn.disabled = true;\n      setTimeout(() => {\n          msg.textContent = 'Отправлено!'; msg.className = 'form-message success';\n          form.reset(); btn.textContent = txt; btn.disabled = false;\n      }, 1500);\n  });\n}\n\n/* 8. COOKIES (FORCE SHOW) */\nfunction initCookies() {\n  const popup = document.getElementById('cookie-popup');\n  const btn = document.getElementById('accept-cookies');\n  // Используем НОВЫЙ ключ, чтобы сбросить историю\n  const key = 'machina_cookie_v3';\n\n  if (!popup || !btn) return;\n\n  if (!localStorage.getItem(key)) {\n      setTimeout(() => {\n          popup.classList.add('show');\n          console.log('Popup Triggered');\n      }, 1500);\n  }\n\n  btn.addEventListener('click', () => {\n      localStorage.setItem(key, 'true');\n      popup.classList.remove('show');\n  });\n}"],"names":["initIcons","initSmoothScroll","initMobileMenu","initHeroAnimation","initStats","initAccordion","initForm","initCookies","lenis","t","raf","time","burger","closeBtn","mobileMenu","links","toggle","e","l","container","animate","uniforms","clock","mouse","targetMouse","renderer","scene","camera","loader","texture","material","section","numbers","started","entries","num","target","isFloat","current","step","timer","h","isOpen","el","form","msg","btn","txt","popup","key"],"mappings":"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"}